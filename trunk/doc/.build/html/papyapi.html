<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
 
 <title>papy - Google Code</title>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
 
 <link rel="shortcut icon" href="http://www.gstatic.com/codesite/ph/images/defaultlogo.png"/>
 <link type="text/css" rel="stylesheet"
       href=".static/custom.css" />
 <link type="text/css" rel="stylesheet"
       href="http://www.gstatic.com/codesite/ph/3770121226765569314/css/ph_core.css" />
 <link type="text/css" rel="stylesheet"
       href="http://www.gstatic.com/codesite/ph/3770121226765569314/css/ph_detail.css" />
 <link rel="stylesheet"  type="text/css"
       href=".static/pygments.css" /> 
 
 <link type="application/atom+xml" rel="alternate"
 href="/feeds/p/papy/svnchanges/basic?path=/wiki/" />
 
 
<!--[if IE]>
 <link type="text/css" rel="stylesheet"
       href="http://code.google.com/hosting/css/d_ie.css" />
<![endif]-->

<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '',
          VERSION:     '1.0b1',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>
    <script type="text/javascript" src=".static/jquery.js"></script>
    <script type="text/javascript" src=".static/interface.js"></script>
    <script type="text/javascript" src=".static/doctools.js"></script>
    <link rel="contents" title="Global table of contents" href="contents.html" />
    <link rel="index" title="Global index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="top" title="PaPy v1.0b1 documentation" href="index.html" />
    <link rel="prev" title="TODO" href="todo.html" />
</head>
<body class="t6">
 <div id=gaia>
  <font size="-1">
 
 <a href="http://code.google.com/p/support/wiki/WhatsNew" style="color:#a03">What's new?</a>
 | <a href="http://code.google.com/p/support/">Help</a>
 
 </font> 

 </div>
 <table style="padding:0px; margin: 0px 0px -6px 0; width:100%" cellpadding=0 cellspacing=0>
 <tr>
 <td><a href="/"><img src="http://www.gstatic.com/codesite/ph/images/defaultlogo.png" alt=papy/></a></td>
 <td>
 
 <div id="pname">
 <a href="http://code.google.com/p/papy/" style="text-decoration:none; color:#000">papy</a>
 
 </div>
 <div id="psum">
 <i><a href="http://code.google.com/p/papy/" style="text-decoration:none; color:#000">PaPy v1.0b1 documentation</a></i>
 </div>
 
 </td>
 <td style="white-space:nowrap; text-align:right">
 
 <form action="http://code.google.com/hosting/search">
 <input size=30 name=q value=""/>
 <input type=submit name=projectsearch value="Search Projects" />
 <input type=submit name=websearch value="Search the Web" />
 </form>
 
 </tr>
 </table>


<table id="mt" cellspacing="0" cellpadding="0" width="100%" border="0">
 <tr>
 <th onclick="if (!cancelBubble) _go('http://code.google.com/p/papy/');">
 <div class="tab inactive">
 <div class="round4"></div>
 <div class="round2"></div>
 <div class="round1"></div>
 <div class="box-inner">
 <a onclick="cancelBubble=true;" href="http://code.google.com/p/papy/">Project&nbsp;Home</a>
 </div>
 </div>
 </th><td>&nbsp;&nbsp;</td>
 
 
 
 
 <th onclick="if (!cancelBubble) _go('http://code.google.com/p/papy/downloads/list');">
 <div class="tab inactive">
 <div class="round4"></div>
 <div class="round2"></div>
 <div class="round1"></div>
 <div class="box-inner">
 <a onclick="cancelBubble=true;" href="http://code.google.com/p/papy/downloads/list">Downloads</a>
 </div>
 </div>
 </th><td>&nbsp;&nbsp;</td>
 
 
 
 
 
 <th onclick="if (!cancelBubble) _go('http://code.google.com/p/papy/w/list');">
 <div class="tab inactive">
 <div class="round4"></div>
 <div class="round2"></div>
 <div class="round1"></div>
 <div class="box-inner">
 <a onclick="cancelBubble=true;" href="http://code.google.com/p/papy/w/list">Wiki</a>
 </div>
 </div>
 </th><td>&nbsp;&nbsp;</td>
 
 
 
 
 
 
 
 <th onclick="if (!cancelBubble) _go('http://code.google.com/p/papy/issues/list');">
 <div class="tab inactive">
 <div class="round4"></div>
 <div class="round2"></div>
 <div class="round1"></div>
 <div class="box-inner">
 <a onclick="cancelBubble=true;" href="http://code.google.com/p/papy/issues/list">Issues</a>
 </div>
 </div>
 </th><td>&nbsp;&nbsp;</td>
 
 
 
 
 
 
 <th onclick="if (!cancelBubble) _go('http://code.google.com/p/papy/source/list');">
 <div class="tab inactive">
 <div class="round4"></div>
 <div class="round2"></div>
 <div class="round1"></div>
 <div class="box-inner">
 <a onclick="cancelBubble=true;" href="http://code.google.com/p/papy/source/list">Source</a>
 </div>
 </div>
 </th><td>&nbsp;&nbsp;</td>
 
 
 
 <td width="100%">&nbsp;</td>
 </tr>
</table>
<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0" class="st">
 <tr>
 
 
 
 <td>
 <div class="issueList">
<div class=isf>
 
 
 
 <a href="index.html">PaPy v1.0b1 documentation</a> |
 <span>
   <a href="genindex.html" title="General Index"
      accesskey="I">index</a>
 </span> |
 <span>
   <a href="modindex.html" title="Global Module Index"
      accesskey="M">modules</a>
 </span> |
 <span>
   <a href="todo.html" title="TODO"
      accesskey="P">previous</a>
 </span> |
 <span class="inIssueList">
   <span>Search</span>
    <form action="search.html" method="GET" style="display:inline">
      <input size=30 name=q value=""/>
      <input type=submit name=projectsearch value="Search Documentation" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
 </span>

</div>
</div>

 </td>
 
 
 
 
 
 
 
 
 <td height=4 align=right valign=top class="bevel-right">
 <div class="round4"></div>
 <div class="round2"></div>
 <div class="round1"></div>
 </td>
 </tr>
</table>
<script>
 var cancelBubble = false;
 function _go(url) { document.location = url; }
</script>

<div id="maincol">
<!-- IE -->



<style>
 #downloadbox { 
 padding: 6px; 
 overflow: hidden;
 white-space: nowrap;
 text-overflow: ellipsis;
 }
 #downloadbox a {
 margin: 0 0 0 0;
 display: block;
 padding-left: 0px;
 }
 #owners a, #members a { white-space: nowrap; }
</style>

<div style="float:right; width:25em; margin:0 0 1em 2em">

 
 <div class=pmeta_bubble_bg>
 <div class="round4"></div>
 <div class="round2"></div>

 <div class="round1"></div>
 <div class="box-inner">
 <table class="pmeta" cellpadding=5>
 <tr><th>Previous:</th>
 <td><ul>
 
 <li>
   <a href="todo.html" title="previous chapter">TODO</a>
 </li>
 

 
 </ul></td>
 </tr>
 
 
 
 </table>

 </div>
 <div class="round1"></div>
 <div class="round2"></div>
 <div class="round4"></div>
 </div>
 
 
 
 <div style="background:#ddf8cc; margin-bottom: 5px;table-layout:fixed">

 <div class="round4"></div>

 <div class="round2"></div>
 <div class="round1"></div>
 <div class="box-inner">
 <div id=downloadbox>
  <b>Table of Contents</b><br/>
  <table class="pmeta toc" cellpadding=5><tr><td>
	<ul>
<li><a class="reference external" href=""><tt class="docutils literal"><span class="pre">papy.papy</span></tt></a></li>
<li><a class="reference external" href="#papy-workers"><tt class="docutils literal"><span class="pre">papy.workers</span></tt></a></li>
<li><a class="reference external" href="#papy-workers-core"><tt class="docutils literal"><span class="pre">papy.workers.core</span></tt></a></li>
<li><a class="reference external" href="#papy-workers-maths"><tt class="docutils literal"><span class="pre">papy.workers.maths</span></tt></a></li>
<li><a class="reference external" href="#papy-workers-io"><tt class="docutils literal"><span class="pre">papy.workers.io</span></tt></a></li>
<li><a class="reference external" href="#imap-imap"><tt class="docutils literal"><span class="pre">IMap.IMap</span></tt></a></li>
</ul>

  </td></tr></table>

 
 </div>
 </div>
 <div class="round1"></div>
 <div class="round2"></div>
 <div class="round4"></div>
 </div>
 
 


 </div>
</div>

 <div style="padding:0 3em 1.2em 0">
   
     
  <div class="section" id="papy-papy">
<span id="module-papy.papy"></span><h1><tt class="xref docutils literal"><span class="pre">papy.papy</span></tt><a class="headerlink" href="#papy-papy" title="Permalink to this headline">¶</a></h1>
<p>This module provides classes and functions to construct and run a papy pipeline.</p>
<dl class="class">
<dt id="papy.papy.Chain">
<em class="property">
class </em><tt class="descclassname">papy.papy.</tt><tt class="descname">Chain</tt><big>(</big><em>iterables</em>, <em>stride=1</em><big>)</big><a class="headerlink" href="#papy.papy.Chain" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a generalization of the zip and chain functions. If stride =1 it
behaves like itertools.zip, if stride =len(iterable) it behaves like
itertools.chain in any other case it zips iterables in strides e.g:</p>
<p>a = Chain([iter([1,2,3]), iter([4,5,6], stride =2)
list(a)
&gt;&gt;&gt; [1,2,4,5,3,6]</p>
<p>it is also resistant to exceptions i.e. if one of the iterables
raises an exception the Chain does not end in a StopIteration, but continues.</p>
</dd></dl>

<dl class="class">
<dt id="papy.papy.Consume">
<em class="property">
class </em><tt class="descclassname">papy.papy.</tt><tt class="descname">Consume</tt><big>(</big><em>iterable</em>, <em>n=1</em>, <em>stride=1</em><big>)</big><a class="headerlink" href="#papy.papy.Consume" title="Permalink to this definition">¶</a></dt>
<dd>This iterator-wrapper consumes n results from the input iterator and zips the
results together. If the result is an exception it is <em>not</em> raised.</dd></dl>

<dl class="class">
<dt id="papy.papy.Dagger">
<em class="property">
class </em><tt class="descclassname">papy.papy.</tt><tt class="descname">Dagger</tt><big>(</big><em>pipers=()</em>, <em>pipes=()</em>, <em>xtras=None</em><big>)</big><a class="headerlink" href="#papy.papy.Dagger" title="Permalink to this definition">¶</a></dt>
<dd><p>The Dagger is a Directed Acyclic Graph.</p>
<p>Arguments:</p>
<blockquote>
<ul>
<li><p class="first">pipers(sequence) [default: ()]</p>
<p>A sequence of valid add_piper inputs</p>
</li>
<li><p class="first">pipes(sequence) [default: ()]</p>
<p>A sequence of valid add_pipe inputs</p>
</li>
</ul>
</blockquote>
<dl class="method">
<dt id="papy.papy.Dagger.add_pipe">
<tt class="descname">add_pipe</tt><big>(</big><em>pipe</em><big>)</big><a class="headerlink" href="#papy.papy.Dagger.add_pipe" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a pipe (A, ..., N) which is an N-tuple tuple of pipers. Adding a pipe
means to add all the pipers and connect them in the specified order. If a</p>
<p>Arguments:</p>
<blockquote>
<ul>
<li><p class="first">pipe(sequence)</p>
<p>N-tuple of Piper instances or objects which can be resolved in the graph
(see: resolve). The pipers are added in the specified order</p>
</li>
</ul>
</blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The direction of the edges in the graph is reversed compared to the data
flow  in a pipe i.e. the target node points to the source node.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="papy.papy.Dagger.add_piper">
<tt class="descname">add_piper</tt><big>(</big><em>piper</em>, <em>create=True</em>, <em>xtra=None</em><big>)</big><a class="headerlink" href="#papy.papy.Dagger.add_piper" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a piper to the graph (only if the piper is not already in the graph).</p>
<p>Arguments:</p>
<blockquote>
<ul>
<li><p class="first">piper(Piper instance, Worker instance or id(Piper instance)</p>
<p>Piper instance or object which will be converted to a piper instance.</p>
</li>
<li><p class="first">create(bool) [default: True]</p>
<p>Should a new piper be created if necessary? If False and piper is not al</p>
</li>
</ul>
</blockquote>
</dd></dl>

<dl class="method">
<dt id="papy.papy.Dagger.add_pipers">
<tt class="descname">add_pipers</tt><big>(</big><em>pipers</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#papy.papy.Dagger.add_pipers" title="Permalink to this definition">¶</a></dt>
<dd>Adds sequence of pipers in specified oreder.</dd></dl>

<dl class="method">
<dt id="papy.papy.Dagger.add_pipes">
<tt class="descname">add_pipes</tt><big>(</big><em>pipes</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#papy.papy.Dagger.add_pipes" title="Permalink to this definition">¶</a></dt>
<dd>Adds sequecne of pipes in specified order.</dd></dl>

<dl class="method">
<dt id="papy.papy.Dagger.connect">
<tt class="descname">connect</tt><big>(</big><big>)</big><a class="headerlink" href="#papy.papy.Dagger.connect" title="Permalink to this definition">¶</a></dt>
<dd>Connects pipers in the correct order.</dd></dl>

<dl class="method">
<dt id="papy.papy.Dagger.del_pipe">
<tt class="descname">del_pipe</tt><big>(</big><em>pipe</em>, <em>forced=False</em><big>)</big><a class="headerlink" href="#papy.papy.Dagger.del_pipe" title="Permalink to this definition">¶</a></dt>
<dd><p>Deletes a pipe (A, ..., N) which is an N-tuple of pipers. Deleting a pipe means
to delete all the connections between pipers and to delete all the pipers.</p>
<p>Arguments:</p>
<blockquote>
<ul>
<li><p class="first">pipe(sequence)</p>
<p>N-tuple of Piper instances or objects which can be resolved in the graph
(see: resolve). The pipers are removed in the reversed order</p>
</li>
<li><p class="first">forced(bool) [default: False]</p>
<p>The forced argument will be given to the del_piper method. If forced is
False only pipers with no down-stream connections will be deleted</p>
</li>
</ul>
</blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The direction of the edges in the graph is reversed compared to the data
flow  in a pipe i.e. the target node points to the source node.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="papy.papy.Dagger.del_piper">
<tt class="descname">del_piper</tt><big>(</big><em>piper</em>, <em>forced=False</em><big>)</big><a class="headerlink" href="#papy.papy.Dagger.del_piper" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes a piper from the graph.</p>
<p>Arguments:</p>
<blockquote>
<ul>
<li><p class="first">piper(Piper instance, Worker instance or id(Piper instance)</p>
<p>Piper instance or object which will be converted to a piper instance.</p>
</li>
<li><p class="first">forced(bool) [default: False]</p>
<p>If forced is False pipers with down-stream connections will not be removed
and will raise a DaggerError.</p>
</li>
</ul>
</blockquote>
</dd></dl>

<dl class="method">
<dt id="papy.papy.Dagger.del_pipers">
<tt class="descname">del_pipers</tt><big>(</big><em>pipers</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#papy.papy.Dagger.del_pipers" title="Permalink to this definition">¶</a></dt>
<dd>Deletes sequence of pipers in specified order.</dd></dl>

<dl class="method">
<dt id="papy.papy.Dagger.del_pipes">
<tt class="descname">del_pipes</tt><big>(</big><em>pipes</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#papy.papy.Dagger.del_pipes" title="Permalink to this definition">¶</a></dt>
<dd>Deletes sequence of pipes in specified order.</dd></dl>

<dl class="method">
<dt id="papy.papy.Dagger.disconnect">
<tt class="descname">disconnect</tt><big>(</big><big>)</big><a class="headerlink" href="#papy.papy.Dagger.disconnect" title="Permalink to this definition">¶</a></dt>
<dd>Disconnects pipers in the correct order.</dd></dl>

<dl class="method">
<dt id="papy.papy.Dagger.resolve">
<tt class="descname">resolve</tt><big>(</big><em>piper</em>, <em>forgive=False</em><big>)</big><a class="headerlink" href="#papy.papy.Dagger.resolve" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a piper or piper id returns the identical piper in the graph.</p>
<p>Arguments:</p>
<blockquote>
<ul>
<li><p class="first">piper(Piper instance, id(Piper instance))</p>
<p>Object to find in the graph.</p>
</li>
<li><p class="first">forgive(bool) [default =False]</p>
<p>If forgive is False a DaggerError is raised whenever a piper cannot
be resolved in the graph. If forgive is True False is returned</p>
</li>
</ul>
</blockquote>
</dd></dl>

<dl class="method">
<dt id="papy.papy.Dagger.start">
<tt class="descname">start</tt><big>(</big><big>)</big><a class="headerlink" href="#papy.papy.Dagger.start" title="Permalink to this definition">¶</a></dt>
<dd>Starts all pipers in the correct order.</dd></dl>

</dd></dl>

<dl class="exception">
<dt id="papy.papy.DaggerError">
<em class="property">
exception </em><tt class="descclassname">papy.papy.</tt><tt class="descname">DaggerError</tt><a class="headerlink" href="#papy.papy.DaggerError" title="Permalink to this definition">¶</a></dt>
<dd>Exceptions raised or related to Dagger instances.</dd></dl>

<dl class="class">
<dt id="papy.papy.Piper">
<em class="property">
class </em><tt class="descclassname">papy.papy.</tt><tt class="descname">Piper</tt><big>(</big><em>worker</em>, <em>parallel=False</em>, <em>consume=1</em>, <em>produce=1</em>, <em>spawn=1</em>, <em>timeout=None</em>, <em>cmp=None</em>, <em>ornament=None</em>, <em>debug=False</em>, <em>name=None</em><big>)</big><a class="headerlink" href="#papy.papy.Piper" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a new Piper instance.</p>
<p>arguments:</p>
<blockquote>
<ul>
<li><p class="first">worker(Worker, Piper or sequence)</p>
<p>Can be a worker or piper instance or a sequence of workers or functions.</p>
</li>
<li><p class="first">parallel(False or IMap instance) [default: 0]</p>
<dl class="docutils">
<dt>The type of parallelism:</dt>
<dd><p class="first">False - linear using built-in imap
IMap instance - parallel using a specified IMap instance.</p>
<p class="last">A custom IMap instance might also be suplied.</p>
</dd>
</dl>
</li>
<li><p class="first">consume(int) [default: 1]</p>
<p>The number of input items consumed and sent to the worker as a batch.</p>
</li>
<li><p class="first">produce(int) [default: 1]</p>
<p>The number of repetitions of each calculated result.</p>
</li>
<li><p class="first">spawn(int) [default: 1]</p>
<p>The number of repeats of this piper to add to the IMap.</p>
</li>
<li><p class="first">timeout(int) [default: 1]</p>
<p>Time to wait till a result is received otherwise a PiperError
is <em>returned</em>.</p>
</li>
<li><p class="first">cmp(func) [default: None -&gt; cmp_ornament]</p>
<p>Compare function to sort the randomly ordered list of upstream
pipers. Preferrably using the ornament attribute, which is the
default. (see ornament)</p>
</li>
<li><p class="first">ornament(object) [default: None -&gt; self]</p>
<p>Anything which can be used by compare functions of down-stream
pipers. By default the ornament is the same as the instance object,
i.e. the default beheviour is equivalent to.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">cmp</span><span class="p">(</span><span class="n">piper_instance1</span><span class="p">,</span> <span class="n">piper_instance2</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">debug(bool) [default: False]</p>
<p>Debug-mode. Raise PiperError on WorkerErrors.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">this will most-likely hang the python interpreter.</p>
</div>
</li>
</ul>
</blockquote>
<dl class="method">
<dt id="papy.papy.Piper.connect">
<tt class="descname">connect</tt><big>(</big><em>inbox</em><big>)</big><a class="headerlink" href="#papy.papy.Piper.connect" title="Permalink to this definition">¶</a></dt>
<dd>Connects the input(s)[inbox] with the output[outbox, next] via the supplied
worker instance and IMap instance.</dd></dl>

<dl class="method">
<dt id="papy.papy.Piper.disconnect">
<tt class="descname">disconnect</tt><big>(</big><em>forced=False</em><big>)</big><a class="headerlink" href="#papy.papy.Piper.disconnect" title="Permalink to this definition">¶</a></dt>
<dd>Disconnects the outbox from the inbox.</dd></dl>

<dl class="method">
<dt id="papy.papy.Piper.next">
<tt class="descname">next</tt><big>(</big><big>)</big><a class="headerlink" href="#papy.papy.Piper.next" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the next result.</p>
<p>If no result is availble within the specified (at initialization) timeout then
a PiperError wrapped TimeoutError is returned.</p>
<p>If the result is a WorkerError it is wrapped in a PiperError and returned or
raised if debug mode was specified at initialization</p>
<p>If the result is a PiperError it is propagated</p>
</dd></dl>

<dl class="method">
<dt id="papy.papy.Piper.start">
<tt class="descname">start</tt><big>(</big><em>forced=False</em><big>)</big><a class="headerlink" href="#papy.papy.Piper.start" title="Permalink to this definition">¶</a></dt>
<dd>Start the</dd></dl>

<dl class="method">
<dt id="papy.papy.Piper.stop">
<tt class="descname">stop</tt><big>(</big><em>forced=False</em><big>)</big><a class="headerlink" href="#papy.papy.Piper.stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Stops the piper. A piper is started if it&#8217;s IMap instance is started and linear
pipers need not to be started or stoped. A piper can be safely stoped if it
either finished or it does not share the IMap instance.</p>
<p>Arguments:</p>
<blockquote>
<ul>
<li><p class="first">forced(sequence) [default =False]</p>
<p>The piper will be forced to stop the IMap instance. A sequence of IMap
task ids needs to be given e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">end_task_ids</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span>       <span class="c"># A list of IMap task ids</span>
<span class="n">piper_instance</span><span class="o">.</span><span class="n">stop</span><span class="p">([</span><span class="mf">0</span><span class="p">,</span><span class="mf">1</span><span class="p">])</span>
</pre></div>
</div>
<p>results in:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">piper_instance</span><span class="o">.</span><span class="n">imap</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">ends</span> <span class="o">=</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="mf">1</span><span class="p">])</span>
</pre></div>
</div>
</li>
</ul>
</blockquote>
</dd></dl>

</dd></dl>

<dl class="exception">
<dt id="papy.papy.PiperError">
<em class="property">
exception </em><tt class="descclassname">papy.papy.</tt><tt class="descname">PiperError</tt><a class="headerlink" href="#papy.papy.PiperError" title="Permalink to this definition">¶</a></dt>
<dd>Exceptions raised or related to Piper instances.</dd></dl>

<dl class="class">
<dt id="papy.papy.Plumber">
<em class="property">
class </em><tt class="descclassname">papy.papy.</tt><tt class="descname">Plumber</tt><big>(</big><em>dagger=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#papy.papy.Plumber" title="Permalink to this definition">¶</a></dt>
<dd><p>The Plumber.</p>
<dl class="method">
<dt id="papy.papy.Plumber.chinkup">
<tt class="descname">chinkup</tt><big>(</big><big>)</big><a class="headerlink" href="#papy.papy.Plumber.chinkup" title="Permalink to this definition">¶</a></dt>
<dd>Stop a running pipeline. Blocks until stopped.</dd></dl>

<dl class="method">
<dt id="papy.papy.Plumber.load">
<tt class="descname">load</tt><big>(</big><em>filename</em><big>)</big><a class="headerlink" href="#papy.papy.Plumber.load" title="Permalink to this definition">¶</a></dt>
<dd>Load pipeline.</dd></dl>

<dl class="method">
<dt id="papy.papy.Plumber.plunge">
<tt class="descname">plunge</tt><big>(</big><em>tasks=None</em>, <em>stride=1</em><big>)</big><a class="headerlink" href="#papy.papy.Plumber.plunge" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs the plumber which means that the next methods of each output piper are
called in cycles and the results discarded.</p>
<p>Arguments:</p>
<blockquote>
<p>Warning! If you change those arguments you should better know what you are
doing. The order of the tasks in the sequence and the stride size defined
here must be compatible with the buffer_size and stride of the IMap
instances used by the pipers.</p>
<ul class="simple">
<li>tasks(sequence of IMapTask instances) [default: None]</li>
</ul>
<blockquote>
If no sequence is give all output pipers are plunged in correct order.</blockquote>
<ul class="simple">
<li>stride(int) [default: 1]</li>
</ul>
<blockquote>
By default take only one result from each output piper. As a general rule
the stride cannot be bigger then the stride of the IMap instances.</blockquote>
</blockquote>
</dd></dl>

<dl class="method">
<dt id="papy.papy.Plumber.save">
<tt class="descname">save</tt><big>(</big><em>filename</em><big>)</big><a class="headerlink" href="#papy.papy.Plumber.save" title="Permalink to this definition">¶</a></dt>
<dd>Save pipeline.</dd></dl>

</dd></dl>

<dl class="exception">
<dt id="papy.papy.PlumberError">
<em class="property">
exception </em><tt class="descclassname">papy.papy.</tt><tt class="descname">PlumberError</tt><a class="headerlink" href="#papy.papy.PlumberError" title="Permalink to this definition">¶</a></dt>
<dd>Exceptions raised or related to Plumber instances.</dd></dl>

<dl class="class">
<dt id="papy.papy.Produce">
<em class="property">
class </em><tt class="descclassname">papy.papy.</tt><tt class="descname">Produce</tt><big>(</big><em>iterable</em>, <em>n=1</em>, <em>stride=1</em><big>)</big><a class="headerlink" href="#papy.papy.Produce" title="Permalink to this definition">¶</a></dt>
<dd><p>This iterator-wrapper yields n-times each result of the input. i.e. if n =2 and
input results are (1, Exception, 2) then the Produce instance will return 2*3
results in the order [1, 1, Exception, Exception, 2, 2] if the stride
=1. If stride =2 the output will look like this: [1, Exception, 1,
Exception, 2, 2].</p>
<p>Note that StopIteration is also an exception!</p>
</dd></dl>

<dl class="class">
<dt id="papy.papy.Worker">
<em class="property">
class </em><tt class="descclassname">papy.papy.</tt><tt class="descname">Worker</tt><big>(</big><em>functions</em>, <em>arguments=None</em><big>)</big><a class="headerlink" href="#papy.papy.Worker" title="Permalink to this definition">¶</a></dt>
<dd><p>The Worker is an object which wraps tuples of functions and their arguments and
and evaluates them when called with a tuple of input data. All exceptions raised
by the functions are cought, wrapped and returned.</p>
<p>The Worker can be initialized in a variety of ways:</p>
<blockquote>
<ul>
<li><p class="first">with a tuple of functions and an (optional)
tuple of tuples of their arguments. e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Worker</span><span class="p">((</span><span class="n">func1</span><span class="p">,</span> <span class="n">func2</span><span class="p">,</span> <span class="n">func3</span><span class="p">),</span> <span class="p">((</span><span class="n">arg1_func1</span><span class="p">,</span> <span class="n">arg2_func1</span><span class="p">),(),</span> <span class="p">()))</span>
</pre></div>
</div>
</li>
<li><p class="first">with another worker instance, which results in their functional equivalence
e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Worker</span><span class="p">(</span><span class="n">worker_instance</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">with multiple worker instances, where the functions and arguments of the
workers are combined e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Worker</span><span class="p">((</span><span class="n">worker1</span><span class="p">,</span> <span class="n">worker2</span><span class="p">))</span>
</pre></div>
</div>
<p>this is equivalent to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Worker</span><span class="p">(</span><span class="n">worker1</span><span class="o">.</span><span class="n">task</span> <span class="o">+</span> <span class="n">worker2</span><span class="o">.</span><span class="n">task</span><span class="p">,</span> <span class="n">worker1</span><span class="o">.</span><span class="n">args</span> <span class="o">+</span> <span class="n">worker2</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">with a single function and its arguments in a tuple e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Worker</span><span class="p">(</span><span class="n">function</span><span class="p">,(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">))</span>
</pre></div>
</div>
<p>which is equivalent to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Worker</span><span class="p">((</span><span class="n">function</span><span class="p">,),((</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">),))</span>
</pre></div>
</div>
</li>
</ul>
</blockquote>
</dd></dl>

<dl class="exception">
<dt id="papy.papy.WorkerError">
<em class="property">
exception </em><tt class="descclassname">papy.papy.</tt><tt class="descname">WorkerError</tt><a class="headerlink" href="#papy.papy.WorkerError" title="Permalink to this definition">¶</a></dt>
<dd>Exceptions raised or related to Worker instances.</dd></dl>

<dl class="function">
<dt id="papy.papy.compose">
<tt class="descclassname">papy.papy.</tt><tt class="descname">compose</tt><big>(</big><em>inbox</em>, <em>args</em>, <em>funcs</em><big>)</big><a class="headerlink" href="#papy.papy.compose" title="Permalink to this definition">¶</a></dt>
<dd>Composes functions.</dd></dl>

<dl class="function">
<dt id="papy.papy.inspect">
<tt class="descclassname">papy.papy.</tt><tt class="descname">inspect</tt><big>(</big><em>piper</em><big>)</big><a class="headerlink" href="#papy.papy.inspect" title="Permalink to this definition">¶</a></dt>
<dd>This function determines the instance (Piper, Worker, FunctionType, Iterable).
It returns a tuple of boolean variables. (is_piper, is_worker, is_function, is_iterable).</dd></dl>

</div>
<div class="section" id="papy-workers">
<span id="module-papy.workers"></span><h1><tt class="xref docutils literal"><span class="pre">papy.workers</span></tt><a class="headerlink" href="#papy-workers" title="Permalink to this headline">¶</a></h1>
<p>This module provides diverse workers.</p>
<blockquote>
<ul class="simple">
<li>core (core functionality)</li>
<li>maths (wrappers around python math and operator modules)</li>
</ul>
</blockquote>
</div>
<div class="section" id="papy-workers-core">
<span id="module-papy.workers.core"></span><h1><tt class="xref docutils literal"><span class="pre">papy.workers.core</span></tt><a class="headerlink" href="#papy-workers-core" title="Permalink to this headline">¶</a></h1>
<p>A collection of core workers-functions to use in Worker instances.</p>
<dl class="function">
<dt id="papy.workers.core.ijoiner">
<tt class="descclassname">papy.workers.core.</tt><tt class="descname">ijoiner</tt><big>(</big><em>inbox</em>, <em>i=0</em>, <em>join=''</em><big>)</big><a class="headerlink" href="#papy.workers.core.ijoiner" title="Permalink to this definition">¶</a></dt>
<dd>Joins and returns the elements of the input with index i.</dd></dl>

<dl class="function">
<dt id="papy.workers.core.ipasser">
<tt class="descclassname">papy.workers.core.</tt><tt class="descname">ipasser</tt><big>(</big><em>inbox</em>, <em>i=0</em><big>)</big><a class="headerlink" href="#papy.workers.core.ipasser" title="Permalink to this definition">¶</a></dt>
<dd><p>Passes the i-th input from inbox. By default passes the first input.</p>
<p>Arguments:</p>
<blockquote>
<ul class="simple">
<li>i(int) [default: 0]</li>
</ul>
</blockquote>
</dd></dl>

<dl class="function">
<dt id="papy.workers.core.njoiner">
<tt class="descclassname">papy.workers.core.</tt><tt class="descname">njoiner</tt><big>(</big><em>inbox</em>, <em>n=None</em>, <em>join=''</em><big>)</big><a class="headerlink" href="#papy.workers.core.njoiner" title="Permalink to this definition">¶</a></dt>
<dd>Joins and returns the first n inputs.</dd></dl>

<dl class="function">
<dt id="papy.workers.core.npasser">
<tt class="descclassname">papy.workers.core.</tt><tt class="descname">npasser</tt><big>(</big><em>inbox</em>, <em>n=None</em><big>)</big><a class="headerlink" href="#papy.workers.core.npasser" title="Permalink to this definition">¶</a></dt>
<dd><p>Passes n first inputs from inbox. By default passes the whole inbox.</p>
<p>Arguments:</p>
<blockquote>
<ul class="simple">
<li>n(int) [default: None]</li>
</ul>
</blockquote>
</dd></dl>

<dl class="function">
<dt id="papy.workers.core.nzipper">
<tt class="descclassname">papy.workers.core.</tt><tt class="descname">nzipper</tt><big>(</big><em>inbox</em>, <em>n=None</em><big>)</big><a class="headerlink" href="#papy.workers.core.nzipper" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="papy.workers.core.plugger">
<tt class="descclassname">papy.workers.core.</tt><tt class="descname">plugger</tt><big>(</big><em>inbox</em><big>)</big><a class="headerlink" href="#papy.workers.core.plugger" title="Permalink to this definition">¶</a></dt>
<dd>Returns nothing.</dd></dl>

<dl class="function">
<dt id="papy.workers.core.sjoiner">
<tt class="descclassname">papy.workers.core.</tt><tt class="descname">sjoiner</tt><big>(</big><em>inbox</em>, <em>s=None</em>, <em>join=''</em><big>)</big><a class="headerlink" href="#papy.workers.core.sjoiner" title="Permalink to this definition">¶</a></dt>
<dd>Joins and returns the first input with indices in s.</dd></dl>

<dl class="function">
<dt id="papy.workers.core.spasser">
<tt class="descclassname">papy.workers.core.</tt><tt class="descname">spasser</tt><big>(</big><em>inbox</em>, <em>s=None</em><big>)</big><a class="headerlink" href="#papy.workers.core.spasser" title="Permalink to this definition">¶</a></dt>
<dd><p>Passes inputs with indecies in s. By default passes the whole inbox.</p>
<p>Arguments:</p>
<blockquote>
<ul class="simple">
<li>s(sequence) [default: None -&gt; range(len(inbox))]</li>
</ul>
</blockquote>
</dd></dl>

</div>
<div class="section" id="papy-workers-maths">
<span id="module-papy.workers.maths"></span><h1><tt class="xref docutils literal"><span class="pre">papy.workers.maths</span></tt><a class="headerlink" href="#papy-workers-maths" title="Permalink to this headline">¶</a></h1>
<p>This module contains worker-functions for common math to use in papy Worker
instances. It wraps around functions from the operator and math standard library
modules. Any function from math and operator is included in this library if it
is related to mathematic evaluations.</p>
<p>If a function accepts multiple arguments two flavours of wrappers are provided:</p>
<blockquote>
<ol class="arabic simple">
<li>simple wrapper: math.X(arg1, arg2) should be called from
papy.workers.maths.X as X([arg1], arg2)</li>
<li>star wrapper: math.X(arg1, arg2) should be called from
papy.workers.maths.Xstar ars Xstar(arg)</li>
</ol>
</blockquote>
<p>In other words 1. should be used to construct workers which accept arguments at
construction and 2. should be used to construct workers which accept multiple
inputs.</p>
</div>
<div class="section" id="papy-workers-io">
<span id="module-papy.workers.io"></span><h1><tt class="xref docutils literal"><span class="pre">papy.workers.io</span></tt><a class="headerlink" href="#papy-workers-io" title="Permalink to this headline">¶</a></h1>
<p>A collection of input/output worker functions. Functions dealing with stream
inputs are normal functions i.e. they cannot be used within a worker. 
Four types of functions are provided.</p>
<blockquote>
<ul class="simple">
<li>logging functions - currently only stdout printing.</li>
<li>stream function - load or save the input stream from or into a single file,
therefore they can only be used at the beginnings or ends of a pipeline.
Stream loaders are not worker functions.</li>
<li>item functions - load, save or process data items.</li>
<li>file functions - create streams from the contents of a file or several
files. These are not worker functions.</li>
</ul>
</blockquote>
<dl class="function">
<dt id="papy.workers.io.dump_item">
<tt class="descclassname">papy.workers.io.</tt><tt class="descname">dump_item</tt><big>(</big><em>inbox</em>, <em>prefix='tmp'</em>, <em>suffix=''</em>, <em>dir=None</em><big>)</big><a class="headerlink" href="#papy.workers.io.dump_item" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes the first element of the inbox as a file. Returns the name
of the file written. By default creates the file in the current working
directory.</p>
<p>This worker is useful to persistantly store data and communicate
parallel pipers without the overhead of using queues.</p>
<p>Arguments:</p>
<blockquote>
<ul>
<li><p class="first">prefix(string) [default: &#8216;tmp&#8217;]</p>
<p>Prefix of the file to be created. Should probably identify the
worker and piper.</p>
</li>
<li><p class="first">suffix(string) [default: &#8216;&#8217;]</p>
<p>Suffix of the file to be created. Should probably identify the file
format of the chunk.</p>
</li>
<li><p class="first">dir(string) [default: current working directory]</p>
<p>Directory where the file will be created.</p>
</li>
</ul>
</blockquote>
</dd></dl>

<dl class="function">
<dt id="papy.workers.io.dump_pickle_stream">
<tt class="descclassname">papy.workers.io.</tt><tt class="descname">dump_pickle_stream</tt><big>(</big><em>inbox</em>, <em>handle</em><big>)</big><a class="headerlink" href="#papy.workers.io.dump_pickle_stream" title="Permalink to this definition">¶</a></dt>
<dd>Writes the first element of the inbox to the provided stream (data
handle) as a pickle. To be used with the <tt class="docutils literal"><span class="pre">load_pickle_stream</span></tt> worker.</dd></dl>

<dl class="function">
<dt id="papy.workers.io.dump_shm_item">
<tt class="descclassname">papy.workers.io.</tt><tt class="descname">dump_shm_item</tt><big>(</big><em>inbox</em><big>)</big><a class="headerlink" href="#papy.workers.io.dump_shm_item" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes the first element of the inbox as POSIX shared memory. Returns
the name of the file written in /dev/shm/.</p>
<p>This worker is useful to temporarily communicate parallel pipers without
the overhead of using queues or on-disk files.</p>
</dd></dl>

<dl class="function">
<dt id="papy.workers.io.dump_stream">
<tt class="descclassname">papy.workers.io.</tt><tt class="descname">dump_stream</tt><big>(</big><em>inbox</em>, <em>handle</em>, <em>delimiter=None</em><big>)</big><a class="headerlink" href="#papy.workers.io.dump_stream" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes the first element of the inbox to the provided stream (file
handle) delimiting the input by the optional delimiter string. Returns
the name of the file being written.</p>
<p>Note that only a single process can have access to a file handle open
for writing. Therefore this worker function should only be used by a
linear piper.</p>
<p>Arguments:</p>
<blockquote>
<ul>
<li><p class="first">handle(stream)</p>
<p>File handle open for writing.</p>
</li>
<li><p class="first">delimiter(string) [default: None]</p>
<p>A string which will seperate the written items. e.g:
&#8220;END&#8221; becomes &#8220;nENDn&#8221; in the output stream. The default is an
empty string which means that items will be seperated by a blank
line i.e.: &#8216;nn&#8217;</p>
</li>
</ul>
</blockquote>
</dd></dl>

<dl class="function">
<dt id="papy.workers.io.find_items">
<tt class="descclassname">papy.workers.io.</tt><tt class="descname">find_items</tt><big>(</big><em>prefix='tmp'</em>, <em>suffix=''</em>, <em>dir=None</em><big>)</big><a class="headerlink" href="#papy.workers.io.find_items" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a file name generator from files matching the supplied
arguments. Matches the same files as those created by <tt class="docutils literal"><span class="pre">dump_chunk</span></tt>
for the same arguments.</p>
<p>Arguments:</p>
<blockquote>
<ul>
<li><p class="first">prefix(string) [default: &#8216;tmp&#8217;]</p>
<p>Mandatory first chars of the files to find.</p>
</li>
<li><p class="first">suffix(string) [default: &#8216;&#8217;]</p>
<p>Mandatory last chars of the files to find.</p>
</li>
<li><p class="first">dir(string) [default: current working directory]</p>
<p>Directory where the files should be located.</p>
</li>
</ul>
</blockquote>
</dd></dl>

<dl class="function">
<dt id="papy.workers.io.json_dumps">
<tt class="descclassname">papy.workers.io.</tt><tt class="descname">json_dumps</tt><big>(</big><em>inbox</em><big>)</big><a class="headerlink" href="#papy.workers.io.json_dumps" title="Permalink to this definition">¶</a></dt>
<dd>Serializes the first element of the input using the JSON protocol.</dd></dl>

<dl class="function">
<dt id="papy.workers.io.json_loads">
<tt class="descclassname">papy.workers.io.</tt><tt class="descname">json_loads</tt><big>(</big><em>inbox</em><big>)</big><a class="headerlink" href="#papy.workers.io.json_loads" title="Permalink to this definition">¶</a></dt>
<dd>De-serializes the first element of the input using the JSON protocol.</dd></dl>

<dl class="function">
<dt id="papy.workers.io.load_item">
<tt class="descclassname">papy.workers.io.</tt><tt class="descname">load_item</tt><big>(</big><em>inbox</em>, <em>remove=True</em><big>)</big><a class="headerlink" href="#papy.workers.io.load_item" title="Permalink to this definition">¶</a></dt>
<dd>Creates an item from a on-disk file.</dd></dl>

<dl class="function">
<dt id="papy.workers.io.load_pickle_stream">
<tt class="descclassname">papy.workers.io.</tt><tt class="descname">load_pickle_stream</tt><big>(</big><em>handle</em><big>)</big><a class="headerlink" href="#papy.workers.io.load_pickle_stream" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates an object generator from a stream (file handle) containing data
in pickles. To be used with the <tt class="docutils literal"><span class="pre">dump_pickle_stream</span></tt>
.. warning:</p>
<div class="highlight-python"><pre>File handles should not be read by different processes.</pre>
</div>
</dd></dl>

<dl class="function">
<dt id="papy.workers.io.load_shm_item">
<tt class="descclassname">papy.workers.io.</tt><tt class="descname">load_shm_item</tt><big>(</big><em>inbox</em>, <em>remove=True</em><big>)</big><a class="headerlink" href="#papy.workers.io.load_shm_item" title="Permalink to this definition">¶</a></dt>
<dd>Creates an item from a POSIX shared memory file. By default unlinks the
associated (temporary) file.</dd></dl>

<dl class="function">
<dt id="papy.workers.io.load_stream">
<tt class="descclassname">papy.workers.io.</tt><tt class="descname">load_stream</tt><big>(</big><em>handle</em>, <em>delimiter=None</em><big>)</big><a class="headerlink" href="#papy.workers.io.load_stream" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a string generator from a stream (file handle) containing
data delimited by the delimiter strings.</p>
<p>This is a stand-alone function and should be used to feed external data
into a pipeline.</p>
<p>Arguments:</p>
<blockquote>
<ul>
<li><p class="first">delimiter(string) [default: None]</p>
<p>The default means that items will be separated by 
two new-line characters i.e.: &#8216;nn&#8217;</p>
</li>
</ul>
</blockquote>
</dd></dl>

<dl class="function">
<dt id="papy.workers.io.make_items">
<tt class="descclassname">papy.workers.io.</tt><tt class="descname">make_items</tt><big>(</big><em>handle</em>, <em>size</em><big>)</big><a class="headerlink" href="#papy.workers.io.make_items" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a generator of items from a file handle. The size argument is
the approximate size of the generated chunks in bytes. The main purpose
of this worker function is to allow multiple worker processes/threads to
read from the same file handle.</p>
<p>A chunk is a 3-tuple (file descriptor, first_byte, last_byte), which 
defines the position of chunk within a file. The size of a chunk i.e. 
last_byte - first_byte is <strong>approximately</strong> the <tt class="docutils literal"><span class="pre">size</span></tt> argument. The
last byte in a chunk is always a &#8216;n&#8217;. The first byte points 
always to the first character in a line. A chunk can also be a whole
file i.e. the first byte is 0 and the last byte is</p>
<p>Arguments:</p>
<blockquote>
<ul>
<li><p class="first">size(int) [default: mmap.ALLOCATIONGRANULARITY]</p>
<p>on windows: 64KBytes
on linux: 4KBytes</p>
<p>Approximate chunk size in bytes.</p>
</li>
</ul>
</blockquote>
</dd></dl>

<dl class="function">
<dt id="papy.workers.io.make_lines">
<tt class="descclassname">papy.workers.io.</tt><tt class="descname">make_lines</tt><big>(</big><em>handle</em>, <em>follow=False</em>, <em>wait=0.10000000000000001</em><big>)</big><a class="headerlink" href="#papy.workers.io.make_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a line generator from a stream (file handle) containing data in
lines.</p>
<p>Arguments:</p>
<blockquote>
<ul>
<li><p class="first">follow(bool) [default: False]</p>
<p>If true follows the file after it finishes like &#8216;tail -f&#8217;.</p>
</li>
<li><p class="first">wait(float) [default: 0.1]</p>
<p>Time to wait between file polls.</p>
</li>
</ul>
</blockquote>
</dd></dl>

<dl class="function">
<dt id="papy.workers.io.mmap_item">
<tt class="descclassname">papy.workers.io.</tt><tt class="descname">mmap_item</tt><big>(</big><em>inbox</em>, <em>close=True</em><big>)</big><a class="headerlink" href="#papy.workers.io.mmap_item" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a mmap object (memory mapped file) from a chunk which should be
the first and only element of the inbox. This can be faster then reading
the chunk. You should <strong>not</strong> call the <tt class="docutils literal"><span class="pre">seek</span></tt> method of the mmap
object as the beginning of the object is <strong>not</strong> the beginning of the
chunk. The index returned <tt class="docutils literal"><span class="pre">tell</span></tt> is the first byte of the chunk, the
last byte is the last byte of the mmap object.</p>
<p>For a description of the chunk see <tt class="docutils literal"><span class="pre">get_chunks</span></tt>.</p>
<p>This is one O(1)</p>
</dd></dl>

<dl class="function">
<dt id="papy.workers.io.open_shm">
<tt class="descclassname">papy.workers.io.</tt><tt class="descname">open_shm</tt><big>(</big><em>name</em><big>)</big><a class="headerlink" href="#papy.workers.io.open_shm" title="Permalink to this definition">¶</a></dt>
<dd><p>Equivalent to the built in open function but opens a file in shared
memory. A single file can be opened multiple times. Only the name of the
file is necessary not the absolute location (most likely /dev/shm/).</p>
<p>Arguments:</p>
<blockquote>
<ul>
<li><p class="first">name(string)</p>
<p>The name of the file to open e.g. &#8216;my_file&#8217; not /dev/shm/my_file</p>
</li>
</ul>
</blockquote>
</dd></dl>

<dl class="function">
<dt id="papy.workers.io.pickle_dumps">
<tt class="descclassname">papy.workers.io.</tt><tt class="descname">pickle_dumps</tt><big>(</big><em>inbox</em><big>)</big><a class="headerlink" href="#papy.workers.io.pickle_dumps" title="Permalink to this definition">¶</a></dt>
<dd>Serializes the first element of the input using the pickle protocol.</dd></dl>

<dl class="function">
<dt id="papy.workers.io.pickle_loads">
<tt class="descclassname">papy.workers.io.</tt><tt class="descname">pickle_loads</tt><big>(</big><em>inbox</em><big>)</big><a class="headerlink" href="#papy.workers.io.pickle_loads" title="Permalink to this definition">¶</a></dt>
<dd>De-serializes the first element of the input using the pickle protocol.</dd></dl>

<dl class="function">
<dt id="papy.workers.io.print_">
<tt class="descclassname">papy.workers.io.</tt><tt class="descname">print_</tt><big>(</big><em>inbox</em><big>)</big><a class="headerlink" href="#papy.workers.io.print_" title="Permalink to this definition">¶</a></dt>
<dd>Prints the first element of the inbox.</dd></dl>

<dl class="function">
<dt id="papy.workers.io.read_item">
<tt class="descclassname">papy.workers.io.</tt><tt class="descname">read_item</tt><big>(</big><em>inbox</em>, <em>close=True</em><big>)</big><a class="headerlink" href="#papy.workers.io.read_item" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads out a string from a chunk which should be the first and only
element in the inbox. This might be slower then memmory mapping the
chunk. The first and last bytes of the string are the first and last
bytes of the chunk.</p>
<p>For a description of the chunk see <tt class="docutils literal"><span class="pre">get_chunks</span></tt>.</p>
</dd></dl>

</div>
<div class="section" id="imap-imap">
<span id="module-IMap.IMap"></span><h1><tt class="xref docutils literal"><span class="pre">IMap.IMap</span></tt><a class="headerlink" href="#imap-imap" title="Permalink to this headline">¶</a></h1>
<p>This module provides a parallel, buffered, multi-task, imap function.
It evaluates results as they are needed, where the need is relative to
the buffer size. It can use threads and processes.</p>
<dl class="class">
<dt id="IMap.IMap.IMap">
<em class="property">
class </em><tt class="descclassname">IMap.IMap.</tt><tt class="descname">IMap</tt><big>(</big><em>func=None</em>, <em>iterable=None</em>, <em>args=None</em>, <em>kwargs=None</em>, <em>worker_type=None</em>, <em>worker_num=None</em>, <em>worker_remote=None</em>, <em>stride=None</em>, <em>buffer=None</em>, <em>ordered=True</em>, <em>skip=False</em>, <em>name=None</em><big>)</big><a class="headerlink" href="#IMap.IMap.IMap" title="Permalink to this definition">¶</a></dt>
<dd><p>Parallel (thread- or process-based), buffered, multi-task, itertools.imap or Pool.imap
function replacment. Like imap it evaluates a function on elements of an iterable, and
it does so layzily(with adjusted buffer via the stride and buffer arguments).</p>
<p>optional arguments:</p>
<blockquote>
<ul>
<li><p class="first">func, iterable, args, kwargs</p>
<p>Defines the the first and only task, it <em>starts</em> the IMap pool and returns an IMap
iterator. For a description of the args, kwargs and iterable input please see
the add_task function. Either <em>both</em> or <em>none</em> func <strong>and</strong> iterable have to be
specified. Arguments and keyworded arguments are optional.</p>
</li>
<li><p class="first">worker_type(&#8216;process&#8217; or &#8216;thread&#8217;) [default: &#8216;process&#8217;]</p>
<p>Defines the type of internally spawned pool workers. For multiprocessing Process
based worker choose &#8216;process&#8217; for threading Thread workers choose &#8216;thread&#8217;.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>This choice has <em>fundamental</em> impact on the performance of the function please
understand the difference between processes and threads and refer to the manual
documentation. As a general rule use &#8216;process&#8217; if you have multiple CPUs or
cores and your functions(tasks) are cpu-bound. Use &#8216;thread&#8217; if your function is
IO-bound e.g. retrieves data from the Web.</p>
<p class="last">If you specify any remote workers via worker_remote, worker_type has
to be the default &#8216;process&#8217;. This limitation might go away in future
versions.</p>
</div>
</li>
<li><p class="first">worker_num(int) [default: number of CPUs, min: 1]</p>
<p>The number of workers to spawn locally. Defaults to the number of availble CPUs, 
which is a reasonable choice for process-based IMaps.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Increasing the number of workers above the number of CPUs makes sense only if
these are Thread-based workers and the evaluated functions are IO-bound.</p>
</div>
</li>
<li><p class="first">worker_remote(sequence or None) [default: None]</p>
<blockquote>
<p>Specify the rpyc hosts and number of workers as a sequence of tuples
(&#8220;host_ip_etc&#8221;, worker_num). For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[[</span><span class="s">&#39;localhost&#39;</span><span class="p">,</span> <span class="mf">2</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mf">2</span><span class="p">]]</span>
</pre></div>
</div>
<p>the TCP port can also be specified:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[[</span><span class="s">&#39;localhost:6666&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</blockquote>
</li>
<li><p class="first">stride(int) [default: worker_num + sum of remote worker_num, min: 1]</p>
<p>The stride argument defines the number of consecutive tasklets which are
submitted to the process/thread pool for a task. This defines the degree
of parallelism. It should not be smaller than the size of the pool, which
is equal to the sum of local and remote threads/processes.</p>
</li>
<li><p class="first">buffer(int) [default: stride * (tasks * spawn), min: variable]</p>
<p>The buffer argument limits the maximum memory consumption in tasklet units, by
limiting the number of tasklets submitted to the pool. By default each task
should receive it&#8217;s own buffer of stride size.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>A tasklet is considered submitted until it is returned by the next method.
The minimum stride is 1 this means that starting the IMap causes one tasklet
to be submitted to the pool input queue. The following tasklet from the next task
can enter the queue only if the first one is calculated and returned by the next
method. A completely lazy evaluation (i.e. submitting the first tasklet <em>after</em>
the next method for the first task has been called is not supported).</p>
<p class="last">If the buffer is n then n tasklets can enter the pool. Depending on the number of
tasks and the stride size these can be tasklets from one or several tasks. If the
tasks are chained i.e. the output from one is consumed by another then at most one
i-th tasklet is at a given moment in the pool. In those cases the minimum required
buffer is lower.</p>
</div>
</li>
<li><p class="first">ordered(bool) [default: True]</p>
<p>If True the output will be ordered i.e. the result of job_17 from task_1 will be
returned after job_16 from any task <em>and</em> job_17 from task_0 <strong>but</strong> before job_18
from any task <em>and</em> job_17 of task_n (for any n &gt; 1).</p>
</li>
<li><p class="first">skip(bool) [default: False]</p>
<p>Should we skip a result if trying to retrieve it rasied a TimeoutError? If the
results are ordered and skip =True then the calling the next method after a
TimeoutError will skip the timeouted result and try to get the next. If
skip =False it will try to get the same result once more. If the results are not
ordered then the next result calculated will be skipped.</p>
</li>
</ul>
</blockquote>
<dl class="method">
<dt id="IMap.IMap.IMap.add_task">
<tt class="descname">add_task</tt><big>(</big><em>func</em>, <em>iterable</em>, <em>args=None</em>, <em>kwargs=None</em>, <em>timeout=None</em>, <em>block=True</em><big>)</big><a class="headerlink" href="#IMap.IMap.IMap.add_task" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a task to evaluate. A task is made of a function an iterable and optional
arguments and keyworded arguments. The iterable can be the result iterator of
a previously added task. A tasklet is a (func, iterable.next(), args, kwargs).</p>
<blockquote>
<ul>
<li><p class="first">func(callable)</p>
<p>Will be called with the elements of the iterable, args and kwargs.</p>
</li>
<li><p class="first">iterable(iterable)</p>
<p>The elements of the iterable will be the first arguments passed to the
func.</p>
</li>
<li><p class="first">args(tuple) [default =None]</p>
<p>A tuple of optional constant arguments passed to the function after the
argument from the iterable.</p>
</li>
<li><p class="first">kwargs(dict) [default =None]</p>
<p>A dictionary of constant keyworded arguments passed to the function after
the variable argument from the iterable and the constant arguments in the
args tuple.</p>
</li>
</ul>
</blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The order in which tasks are added to the IMap instance is important. It
affects the order in which tasks are submited to the pool and consequently
the order in which results should be retrieved. If the tasks are chained
then the order should be a valid topological sort (reverse topological
oreder).</p>
</div>
</dd></dl>

<dl class="method">
<dt id="IMap.IMap.IMap.get_task">
<tt class="descname">get_task</tt><big>(</big><em>task=0</em>, <em>timeout=None</em>, <em>block=True</em><big>)</big><a class="headerlink" href="#IMap.IMap.IMap.get_task" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns an iterator which results are bound to one task. The default iterator
the one which e.g. will be used by default in for loops is the iterator for
the first task (task =0). Compare:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">result_from_task_0</span> <span class="ow">in</span> <span class="n">imap_instance</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">result_from_task_1</span> <span class="ow">in</span> <span class="n">imap_instance</span><span class="o">.</span><span class="n">get_task</span><span class="p">(</span><span class="n">task_id</span> <span class="o">=</span><span class="mf">1</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>a typical use case is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">task_0_iterator</span> <span class="o">=</span> <span class="n">imap_instance</span><span class="o">.</span><span class="n">get_task</span><span class="p">(</span><span class="n">task_id</span> <span class="o">=</span><span class="mf">0</span><span class="p">)</span>
<span class="n">task_1_iterator</span> <span class="o">=</span> <span class="n">imap_instance</span><span class="o">.</span><span class="n">get_task</span><span class="p">(</span><span class="n">task_id</span> <span class="o">=</span><span class="mf">1</span><span class="p">)</span>

<span class="k">for</span> <span class="p">(</span><span class="n">task_1_res</span><span class="p">,</span> <span class="n">task_0_res</span><span class="p">)</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">task_0_iterator</span><span class="p">,</span> <span class="n">task_1_iterator</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="IMap.IMap.IMap.next">
<tt class="descname">next</tt><big>(</big><em>timeout=None</em>, <em>task=0</em>, <em>block=True</em><big>)</big><a class="headerlink" href="#IMap.IMap.IMap.next" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the next result for the given task (default 0).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>the next result for task n can regardless of the buffersize be evaluated
only if the result for task n-1 has left the buffer.</p>
<p class="last">If multiple tasks are evaluated then those tasks share not only the process
or thread pool but also the buffer, the minimal buffer size is one and
therefore the results from the buffer have to be removed in the same order
as tasks are submitted to the pool. The tasks are submited in a topological
order which allows to chain them.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If multiple chained tasks are evaluated then the next method of only the
last should be called directly. Otherwise the pool might dead-lock depending
on the buffer-size. This is a consequenceof the fact that tasks are
submitted to the pool in a next-needed order. Calling the next method of an
up-stream task changes this topological evaluation order.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="IMap.IMap.IMap.start">
<tt class="descname">start</tt><big>(</big><big>)</big><a class="headerlink" href="#IMap.IMap.IMap.start" title="Permalink to this definition">¶</a></dt>
<dd>Starts the processes or threads in the pool, the threads which manage
the pools input and output queues respectively. These processes/threads are
killed either when all the results are calculated and retrieved or the stop
method is called.</dd></dl>

<dl class="method">
<dt id="IMap.IMap.IMap.stop">
<tt class="descname">stop</tt><big>(</big><em>ends=None</em><big>)</big><a class="headerlink" href="#IMap.IMap.IMap.stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Stops the worker pool threads/processes and the threads which manage the
input and output queues of the pool respectively. It stops IMap instances
which did not consume the input and/or calculate the results. Blocks the
calling thread until all threads and/or processes returned.</p>
<blockquote>
<ul>
<li><p class="first">ends(list) [default: None]</p>
<p>A list of task ids which are not consumed within the IMap instance. All
buffered results will be lost and up to 2*stride of inputs consumed. If no
list is given the end tasks will need to be manually consumed if this is
not done threads/processes might not terminate and the Python interpreter
will not exit cleanly.</p>
</li>
</ul>
</blockquote>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="IMap.IMap.IMapTask">
<em class="property">
class </em><tt class="descclassname">IMap.IMap.</tt><tt class="descname">IMapTask</tt><big>(</big><em>iterator</em>, <em>task</em>, <em>timeout</em>, <em>block</em><big>)</big><a class="headerlink" href="#IMap.IMap.IMapTask" title="Permalink to this definition">¶</a></dt>
<dd><p>Object returned by the get_task method of IMap instances.
It is a wrapper around an <em>IMap</em> instance which returns
results only for specified arguments: task, timeout, block.</p>
<p>Arguments:</p>
<blockquote>
<ul>
<li><p class="first">iterator(IMap instance)</p>
<p><em>IMap</em> instance to wrap, usually this is called by the get_task method
of the <em>IMap</em> instance itself.</p>
</li>
<li><p class="first">task(integer)</p>
<p>Id of the task from the <em>IMap</em> instance.</p>
</li>
<li><p class="first">timeout</p>
<p>see documentation for: <em>IMap.next</em></p>
</li>
<li><p class="first">block</p>
<p>see documentation for: <em>IMap.next</em></p>
</li>
</ul>
</blockquote>
<dl class="method">
<dt id="IMap.IMap.IMapTask.next">
<tt class="descname">next</tt><big>(</big><big>)</big><a class="headerlink" href="#IMap.IMap.IMapTask.next" title="Permalink to this definition">¶</a></dt>
<dd>Returns a result if availble within timeout else raises
a TimeoutError. See documentation for <em>IMap.next</em></dd></dl>

</dd></dl>

<dl class="class">
<dt id="IMap.IMap.PriorityQueue">
<em class="property">
class </em><tt class="descclassname">IMap.IMap.</tt><tt class="descname">PriorityQueue</tt><big>(</big><em>maxsize=0</em><big>)</big><a class="headerlink" href="#IMap.IMap.PriorityQueue" title="Permalink to this definition">¶</a></dt>
<dd>A priority queue using a heap on a list.
This Queue is thread but not process safe.</dd></dl>

<dl class="class">
<dt id="IMap.IMap.Weave">
<em class="property">
class </em><tt class="descclassname">IMap.IMap.</tt><tt class="descname">Weave</tt><big>(</big><em>iterables</em>, <em>repeats=1</em><big>)</big><a class="headerlink" href="#IMap.IMap.Weave" title="Permalink to this definition">¶</a></dt>
<dd><p>Weaves a sequence of iterators, which can be stopped if the same number
of results has been consumed from all iterators.</p>
<p>Arguments:</p>
<p>TODO: refactor iterables -&gt; iterators</p>
</dd></dl>

<dl class="function">
<dt id="IMap.IMap.imports">
<tt class="descclassname">IMap.IMap.</tt><tt class="descname">imports</tt><big>(</big><em>modules</em>, <em>forgive=False</em><big>)</big><a class="headerlink" href="#IMap.IMap.imports" title="Permalink to this definition">¶</a></dt>
<dd><p>Should be used as a decorator to attach import statments to function
definitions. And import them in the in the global namespace of the 
function.</p>
<p>Two forms of import statements are supported:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">module</span>                    <span class="c"># e.q. to [&#39;module&#39;, []]</span>
<span class="kn">from</span> <span class="nn">module</span> <span class="kn">import</span> <span class="n">sub1</span><span class="p">,</span> <span class="n">func2</span>   <span class="c"># e.q. to [&#39;module&#39;, [&#39;sub1&#39;, func2]]</span>
</pre></div>
</div>
<p>The imported modules should be considered as availble only inside the 
decorated functions.</p>
<p>Arguments:</p>
<blockquote>
<ul>
<li><p class="first">modules(list)</p>
<p>A list of modules in the following forms:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;module&#39;</span><span class="p">,[</span><span class="s">&#39;sub_module1&#39;</span><span class="p">,</span> <span class="o">...</span> <span class="p">,</span><span class="s">&#39;sub_module2&#39;</span><span class="p">]]</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;module&#39;</span><span class="p">,[]]</span>
</pre></div>
</div>
<p>If a list of sub-modules is specified they will be availble in the
globals of the function i.e:</p>
<div class="highlight-python"><pre># re module availble in the namespace
@imports([['re',[]]])
  def need_re(some_string):
      res = re.search('pattern',some_string)
      return res.group()

# search function availble in the namespace
@imports([['re',['search']]])
  def need_re(some_string):
      res = search('pattern',some_string) #!
      # but re.search will also work.
      return res.group()</pre>
</div>
</li>
<li><p class="first">forgive(bool)</p>
<p>If True will not raise exception on ImportError.</p>
</li>
</ul>
</blockquote>
</dd></dl>

<dl class="function">
<dt id="IMap.IMap.inject_func">
<tt class="descclassname">IMap.IMap.</tt><tt class="descname">inject_func</tt><big>(</big><em>func</em>, <em>conn</em>, <em>i</em><big>)</big><a class="headerlink" href="#IMap.IMap.inject_func" title="Permalink to this definition">¶</a></dt>
<dd>Injects a function object into a rpyc connection object</dd></dl>

<dl class="function">
<dt id="IMap.IMap.worker">
<tt class="descclassname">IMap.IMap.</tt><tt class="descname">worker</tt><big>(</big><em>inqueue</em>, <em>outqueue</em>, <em>host=None</em><big>)</big><a class="headerlink" href="#IMap.IMap.worker" title="Permalink to this definition">¶</a></dt>
<dd>Function which is executed by processes/threads within the pool.
It waits for tasks (function, data, arguments) at the input queue
evaluates the result and passes it to the output queue.</dd></dl>

</div>


   
 
 
 </div>
<div id="footer" dir="ltr">
 
 <div class="text">
 
 &copy;2008 Google -
 <a href="http://code.google.com/">Code Home</a> -
 <a href="http://code.google.com/tos.html">Terms of Service</a> -
 <a href="http://www.google.com/privacy.html">Privacy Policy</a> -
  
 </body>
</html>
